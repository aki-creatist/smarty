# 関数

## ゴール

関数を作成する

## 概要

### 関数とは

* 関数とは`命令`のこと
    * `命令` とは `処理` のまとまり
    * オブジェクトに所属している関数をメソッドと呼ぶ
    * 独自に作成する関数を`ユーザ定義関数`と呼ぶ
* 関数を作るとは、`新しい命令を作る`こと

### ユーザ定期関数

* ユーザが独自に定義する関数
* 小さなプログラムの集まり
    * `サブルーチン` ともいう
    * 処理が重複する場合、関数にまとめて再利用する
        * 一箇所の変更が、使用箇所全てに及ぶ
            * 保守性が高まる

### 意義

* 通常のコード
    * ファイルに記述された順に上から解釈して実行される
    * 逆戻りすることができない
        * 同じ処理を何度も書かなければならない
* 関数
    * 関数のブロック内のコードは、関数が書かれた位置とは関係ない
        * 呼び出されたときに実行される

### 関数を作成

```php
function 関数名()
{
    // 処理の内容
}
```

#### 引数

* 作成した関数の中で利用する値を、関数の外から与える値
    * 引数として関数に値が渡すには
        * 関数作成時
            * 受け取り用の$引数を `()`の中に記述しておく
        * 実行時
            * `渡したい値` を関数名() `()` の中に記述
* 送る側と受け取る側、どちらも引数と呼ばれるが細かく分けると以下のようになる
    * 送る側の引数: 実引数(例：add(50, 50)の引数が実引数)
    * 受け取り側の引数: 仮引数(例：add(int x, int y)の引数が仮引数)

例

* `say_hello`を用意する
    * `$myname` を受け取るよう準備しておく
* 変数`$myname`に`AKI`を格納
* 実行時に変数`$myname`を渡す

```php
<?php
$myname = "AKI";

say_hello($myname);

function say_hello($name)
{
    echo "hi " . $name . " <br />" ;
}
```

* 関数の外側で宣言された変数
    * `JavaScript`
        * 関数の中で参照ができる
    * `PHP`
        * 関数の中で参照ができない

```php
<?php
$data = 5; //グローバルスコープの変数

function scope_test()
{
    return $data;
}
echo $data; // 5
echo scope_test(); // Notice: Undefined variable: data
```

```javascript
var p = "外側の変数p";
function A() 
{
     return p;
}
document.write(A()); // 外側の変数p
```

### return文 (返り値)

* return文
    * 関数で処理した結果を返す
    * 関数で処理した結果を受け取りたいときに使用
    * この値を`返り値`という (または`戻り値`)

返り値を受け取る

```php
$変数 = $関数()
```

```php
function exam()
{
    return 返したい値を指定
}
```


[return文のテスト](return.html)
[ソース](return.php)

* 入力バイト数をチェックする関数を例にreturn文の動作を確認
    * `checkByte`関数を作成
    * 文字列のバイト数が指定したバイト数`以上/以下`を判定
        * 引数のバイト数を`strlen()`で得る
        * 結果を変数`$strlen`に格納
        * if文で`$strlen`と`$byte`を比較判定
            * 以下ならTRUEが返す
            * 以上ならFALSEが返す
    * `checkByte($str,$byte);`と引数を指定して、checkByte関数を実行
    * 返った結果により条件を分岐する
        * $flgがTRUEの場合、`OKです` と出力
        * $flgがFALSEの場合、`エラーです`と出力

### スコープ

* 以下の２つに分けられる
    * ローカルスコープ
        * 関数の中でのみ有効な範囲
            * 関数内で作成した変数は、`ローカル変数`となる
                * 変数の作成部分と利用部分が近い
                * グローバル変数よりはわかりやすさに気を使う必要がない
                * `短くて入力しやすい名前`を推奨
            * `関数脱出時に消滅`する
    * グローバルスコープ
        * プログラム中のどこからでも有効な範囲
            * scriptタグ内に定義した変数は`グローバル変数`となる
                * `長いわかりやすい名前`を推奨
            * scriptタグ内に定義した関数はグローバル関数となる

グローバル変数とローカル変数の名前が重複した場合、ローカル変数が優先される

#### ローカルスコープ

関数内の変数xとグローバル変数xは別物

```javascript
var p = "外側の変数p";
function A() 
{
    var p = "内側の変数p"; // グローバル変数
    return p;
}
document.write(A()); // 内側の変数p
document.write(p);   // 外側の変数p
```

#### グローバルスコープ

関数内でグローバルスコープを参照する

手段は、前述の通り、`PHP`と`JS`では異なる

* JS
    * ブロック外の変数を参照できる
* PHP
    * `グローバル宣言`により参照できる
        * 方法1
            * `global`を使用したい変数の前に使う
                * [global_scope.php](global_scope.php)
        * 方法2
            * `$GLOBALS`のキーを$変数名にする
            * これにより内容を参照、代入することができる
            * `$GLOBALS`はどこでも利用できる
            * そのため`スーパーグローバル変数`と呼ばれる
                * [global_scope2.php](global_scope2.php)

```javascript
var p = "外側の変数p";
function A()
{
     p = "内側の変数p"; // グローバル変数
    return p;
}
document.write(A()); // 内側の変数p
document.write(p);   // 内側の変数p
```

### テスト

#### カウンタ変数を`i`に変えてテスト

入れ子のfor文で、同じ`i`という名前のカウンタ変数を使用

* 確認したいこと
    * `ローカル変数`であればカウンタ変数が重複していても問題がないこと
        * 変数iが関数の中で作成する

##### ローカル

[ローカルスコープのテスト](scope_local.php)

* 親ループが0~2まで計3周する
* miniRoop関数の中では、for文によって1〜kazuの繰り返しを行う
    * 入れ子のループ(miniRoop関数の処理)を抜けた後の変数iの値に変更なし

##### グローバル

[グローバルスコープのテスト](scope_global.php)

* 親ループが本来0~2まで計3周する
* 子ループの中で変数$iの値が変更され、１周しかないという事態が起こす

処理の流れは以下

* 親ループの変数$iが０として処理を開始
    * 子ループの変数$iが０として処理を開始
    * 子ループがもう１周し、変数$iが1として処理を開始
    * 子ループは$`i < 2`に達したのでループを抜ける
* 子ループを抜けた時点で変数$iは２
* 親ループの変数$iは抜け際インクリメントで３になっているため処理しない

無限ループ

* `$i < =3`、または、`$i < 4`という条件式に変えた場合
    * 無限ループになる
        * 親ループの$iが永遠と `3` であり続けるため
        
### static

* `static`の利用
    * 変数の有効範囲は関数内のまま使用できる
        * 外から直接参照することは不可
        * 関数実行時に`直近の値`を参照可能
    * [static](static.php)

```php
function 関数()
{
    static $変数
}
```
