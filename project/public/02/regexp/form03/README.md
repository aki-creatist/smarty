# 正規表現

* 正規表現パターン文字列のパターンを表現するための仕組み
    * 曖昧な文字列を検索するために利用

## 基本構造

* 条件式
    * `true`または`1`
        * マッチしている
    * `false`または`0`
        * マッチしていない

```
if (比較メソッド(パターン, 文字列) {
    // 一致する場合 // true もしくは 1
} else {
    // 一致しない場合 // false もしくは 0
}
```

## 概要

送信フォームで『半角英数字3桁(例：123)』以外が送信された場合、エラー出力をする

それぞれ『半角英数字3桁』の条件は同じ

* Javascript
    * フォームに入力がされたタイミングで判定
* jQuery
    * 送信ボタンが押されたタイミングで判定
* PHP
    * 送信ボタンが押されたタイミングで判定
        * ただし、ブラウザのJavascriptが無効になっていることが条件

## 事前準備

入力値の検証機能を実装するための準備

基本的には[form01](../form01/README.md)の事前準備と同様

ただし、正規表現による検証を行うため、今回はクラスに以下を指定する

```html
<input 〜中略〜 class="valid required regexp" ...}>
```

## 実装

### PHPで検証機能を実装する

```php
preg_match(正規表現パターン, 文字列);
```

```php
if (preg_match( 正規表現のパターン, 文字列 ) {
	// マッチした場合の処理
} else {
	// マッチしなかった場合の処理
}
```

```php
$number = "123456";

if (preg_match("/[0-9]+/", $number)) {
	echo "数字です！";
} else {
	echo "数字以外の文字です。";
}
```

### javascriptで検証機能を実装する

```javascript
var 変数 = /正規表現のパターンテキスト/;
```

例として数値のみ許容

* パターンでRegExpオブジェクトを作成
    * そのtestメソッドを利用してテキストがパターンにマッチしているかをチェック
        * マッチした場合
            * `true`を返される
        * マッチしない場合
            * `false`が返される

```javascript
var regexp = /^\-?\d+$/;
if (regexp.test(str)) {
    // 当てはまる場合の処理
} else {
    // 当てはまらない場合の処理
}
```

### jqueryで検証機能を実装する

#### フィルタリング

* filterメソッドで特定の検証名を持つ要素だけに絞り込み
    * 要素セットから条件に合致した要素だけを取り出す

### フォーマット検証

フォーマット検証を行うための正規表現パターン(RegExpオブジェクト)を生成

```javascript
// new RegExp(正規表現, オプション)
var reg = new RegExp($(this).data('pattern'), 'gi');
if (!reg.test($(this).val())) {
    
}
```

* testメソッド
    * 指定されたパターンと入力値($(this).val())を比較
        * 両者が合致するかどうかを検査

```javascript
RegExpオブジェクト.test(値)
```

* testメソッドがfalse(偽)を返した場合にエラーであるとみなす
    * `!reg.test(...)`と`reg.test(...) === false`と同じ意味

## PHPの正規表現をテストする

ブラウザのJavascriptを無効化する。

Javascriptが有効になっている間は、
フォームに誤った値を挿入し送信をしても送信されない。

以下のURLをブラウザの検索バーに挿入する

chrome://settings/content/javascript

もしくは以下の手順

1. Chrome 右上の[設定]ボタン＞[設定]をクリック
2. メニューの一番下にある「詳細設定　▼」をクリック
3. コンテンツの設定をクリック
4. Javascriptをクリック
5. 右端をクリックして無効化する
