# 外部ファイルの読み込みと書き込み


### ファイルポインタ

#### 概要

* ファイルシステム関数を活用するのに必須
    * FILE型へのポインタのこと
        * ファイルを現在読み書きしている位置を示す目印
        * 本を読んでいくときに、読んでいる場所を指で追っていくようなイメージ
        * 「自分がいまファイルのどの部分を読み書きしているのか」を記憶しておける
    * ファイルを開いた直後は、ファイルの先頭に位置している
    * 読み書きの操作に合わせて移動する
        * `追記`などができるのはファイルポインタが`最後に書き込んだ位置`を覚えているから
    
#### FILE型が管理する情報

* 入出力の現在位置(ファイル位置指示子)
* ファイルの終端に達したかの情報(ファイル終了指示子)
* エラー情報(エラー指示子)

#### ファイルポインタの取得

* `fopen()`によって取得する
    * 操作後は`fclose()`で閉じる

```php
fopen(外部ファイル);
```

### ファイルロック

処理が競合を防止する

```php
flock(ファイル名, オプション);
```

以下のオプションを指定することができる

* LOCK_SH - 共有ロック (読み込み中なので、他者による書き込みを禁止する)
    * 自分がいまファイルを読み込んでいるので、ほかの人は書き込んではいけません（読むだけならいいよ）
* LOCK_EX - 排他ロック (書き込み中なので、他者による読み書きを禁止する)
    * 自分がいまファイルを書き込んでいるので、他の人は読むのも書くのもやめてくださいね
* LOCK_UN - ロックの解除